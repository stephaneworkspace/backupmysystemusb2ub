
<h1 id="backupmystemusb2usb-backup-my-system-usb-to-usb">backupmystemusb2usb: Backup my system usb to usb</h1>
<p>backupmystemusb2usb is a GPLv3-liscensed Python package to copy usb key.</p>
<p>Its runs on Python 3.7 and has a dependency for yaml, and another one for the gui.</p>
<h2 id="installation-without-the-source">Installation without the source</h2>
<p>To install <em>backupmysytemusb2usb</em> package run the following command:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> apt-get install libyaml-dev python3-gi
<span class="kw">sudo</span> -H pip3 install backupmystemusb2usb</code></pre>
<p>You have to create a config.yml file (you can save it into your ~/.local/share/backupmysystemusb2usb directory)</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">UUID_1_Master</span>: 790d1fbb-96ed-46c3-868d-08e05e223fa7
<span class="kw">UUID_1_Slave</span>: 790d1fbb-96ed-46c3-868d-08e05e223fa7
<span class="kw">Temp_img</span>: /home/stephane/Temp/Linux.img
<span class="kw">Temp_log</span>: /home/stephane/Temp/BackupMySystem-Temp.log
<span class="kw">Kill_dd</span>: True</code></pre>
<p>UUID list</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> blkid</code></pre>
<p>Find your device and to change the label if the device master UUID is the same as the slave UUID (for exemple: if you cancel in copying temporary img to disk slave), you have to put a date upper on master than slave</p>
<p><em>Warning</em> UUID is not Label !</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> e2label /dev/sd_1 <span class="st">&quot;19991231235959&quot;</span></code></pre>
<p>For the deamon, write a <em>run.py</em> for running by user root with chmod 700</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/usr/bin/env python3</span>
<span class="kw">import</span> sys
<span class="kw">import</span> yaml
<span class="kw">from</span> backupmysystemusb2usb.usb2usb import usb2usb
<span class="kw">try</span>:
   <span class="kw">u2u</span> = usb2usb(sys.argv[1])
   <span class="kw">u2u.backup</span>()
<span class="kw">except</span> yaml.YAMLError:
   <span class="fu">exit()</span></code></pre>
<p>You can create a service systemd if you planed to backup your usb key every day in the morning. You can wakeonlan from a raspberrypi or with another technic</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">wakeonlan</span> MACADRESS
<span class="kw">crontab</span> -e
<span class="co"># write your cron</span>
<span class="kw">sudo</span> service cron reload</code></pre>
<p>Now to create a daemon in startup (without console).</p>
<p>Use this name &quot;backupmysystemusb2usb&quot; because in source const.py this file is a constant for GUI progress for non-root user</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> /etc/systemd/system
<span class="kw">vi</span> backupmysystemusb2usb.service</code></pre>
<p>Write</p>
<pre class="sourceCode bash"><code class="sourceCode bash">[<span class="kw">Unit</span>]
<span class="ot">After=</span>ssh.service

[<span class="kw">Service</span>]
<span class="ot">WorkingDirectory=</span>/your/working/path/
<span class="ot">ExecStart=</span>/usr/bin/sh <span class="kw">-c</span> <span class="st">&quot;/your/working/path/run.py /your/working/path/config.yml&quot;</span>

[<span class="kw">Install</span>]
<span class="ot">WantedBy=</span>default.target</code></pre>
<p>Enable and start</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> systemctl daemon-reload
<span class="kw">sudo</span> systemctl enable backupmysystemusb2usb</code></pre>
<p>Then the service start on reboot. If you will test now the service :</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> systemctl start backupmysystemusb2usb</code></pre>
<p>Check the log (the last 20 messages)</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> journalctl --unit backupmysystemusb2usb -n 20</code></pre>
<p>You can go to check your output log file configured by config.yml</p>
<p>Now we have to create the shell return for non-root user gui.py</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">touch</span> gui.py
<span class="kw">chmod</span> 700 gui.py
<span class="kw">vi</span> gui.py</code></pre>
<p>And write in file</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/usr/bin/env python3</span>
<span class="kw">import</span> yaml
<span class="kw">from</span> backupmysystemusb2usb.usb2usb import usb2usb
<span class="kw">u2u</span> = usb2usb(<span class="st">&#39;/path/to/your/config.yml&#39;</span>)
<span class="kw">u2u.gui</span>()</code></pre>
<p>You can create a autostart Gnome desktop startup</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> ~/.config/autostart
<span class="kw">touch</span> backupmysystemusb2usb.desktop
<span class="kw">chmod</span> 744
<span class="kw">vi</span> backupmysystemusb2usb.desktop</code></pre>
<p>And in your editor enter</p>
<pre class="sourceCode bash"><code class="sourceCode bash">[<span class="kw">Desktop</span> Entry]
<span class="ot">Name=</span>Backup <span class="kw">my</span> system usb to usb
<span class="ot">Comment=</span>Copy <span class="kw">disk</span> with the same space
<span class="ot">Exec=</span>/your/working/path/gui.py
<span class="ot">Icon=</span>org.gnome.Terminal
<span class="ot">Path=</span>/your/working/path/
<span class="ot">Terminal=</span>true
<span class="ot">Hidden=</span>false
<span class="ot">Type=</span>Application
<span class="ot">Categories=</span>Utility;<span class="kw">Application;</span></code></pre>
<h2 id="installation-from-source">Installation from source</h2>
<p>To install the latest developement version run the following command:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> clone https://github.com/stephaneworkspace/backupmysystemusb2usb</code></pre>
<h2 id="versions">Versions</h2>
<dl>
<dt>1.02</dt>
<dd><ul>
<li>Fix bug and rename label usb key</li>
</ul>
</dd>
<dt>1.0.1</dt>
<dd><ul>
<li>Add gui Gtk</li>
</ul>
</dd>
<dt>0.0.16</dt>
<dd><ul>
<li>Alpha version</li>
</ul>
</dd>
</dl>
